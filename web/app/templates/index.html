{% extends "base.html" %}
{% block content %}
<h1 class="text-2xl font-bold mb-4">Open Wagers</h1>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
  {% for user in users %}
  <div class="bg-white rounded-xl shadow p-4">
    <!-- User info -->
    <div class="flex items-center gap-3 mb-3">
      <img src="{{ user.profile_pic_url }}" alt="{{ user.display_name }}" class="w-10 h-10 rounded-full">
      <h2 class="text-xl font-semibold">{{ user.display_name }}</h2>
    </div>

    <!-- Wagers -->
    <div class="space-y-3 mt-3">
      {% for wager in user.wagers %}
        {% if wager.status != 'removed' %}
        <div class="relative border p-3 rounded-xl flex justify-between items-center group">
          <!-- Status Badge -->
          <div class="absolute -top-2 -left-2">
            {% if wager.status == 'won' %}
              <span class="bg-green-500 text-white text-xs font-bold px-2 py-1 rounded shadow">WON</span>
            {% elif wager.status == 'lost' %}
              <span class="bg-red-500 text-white text-xs font-bold px-2 py-1 rounded shadow">LOST</span>
            {% else %}
              <span class="bg-blue-500 text-white text-xs font-bold px-2 py-1 rounded shadow">OPEN</span>
            {% endif %}
          </div>

          <!-- Description + Amount/Line + Action Buttons -->
          <div>
            <p class="font-medium">{{ wager.description }}</p>
            <p class="text-sm text-gray-600">Amount: ${{ wager.amount }} | Line: {{ wager.line }}</p>
            {% if wager.payout is not none %}
            <p class="text-sm text-gray-600">Payout: ${{ '{:,.2f}'.format(wager.payout) }}</p>
            {% endif %}
            {% if wager.legs %}
            <div class="mt-3 space-y-2">
              {% for leg in wager.legs %}
              <div class="bg-gray-100 rounded-lg px-3 py-2 flex items-center justify-between">
                <div>
                  <p class="text-sm font-medium text-gray-800">{{ leg.description }}</p>
                  <span class="text-xs font-semibold px-2 py-0.5 rounded-full
                    {% if leg.status == 'won' %} bg-green-500 text-white
                    {% elif leg.status == 'lost' %} bg-red-500 text-white
                    {% else %} bg-blue-500 text-white {% endif %}">
                    {{ leg.status|upper }}
                  </span>
                </div>
                <form method="post" action="/wagers/{{ wager.id }}/legs/{{ leg.id }}/status" class="flex gap-2">
                  <button name="status" value="won"
                          class="transition transform hover:scale-125 bg-green-500 text-white px-2 py-1 rounded-full">✅</button>
                  <button name="status" value="lost"
                          class="transition transform hover:scale-125 bg-red-500 text-white px-2 py-1 rounded-full">❌</button>
                </form>
              </div>
              {% endfor %}
            </div>
            {% endif %}

            <form method="post" action="/wagers/{{ wager.id }}/status"
                  class="hidden group-hover:flex gap-2 mt-2 transition ease-in-out duration-200">
              <button name="status" value="won"
                      class="transition transform hover:scale-125 bg-green-500 text-white px-3 py-1 rounded-full">✅</button>
              <button name="status" value="lost"
                      class="transition transform hover:scale-125 bg-red-500 text-white px-3 py-1 rounded-full">❌</button>
              <button name="status" value="removed"
                      onclick="return confirm('Are you sure you want to remove this wager?')"
                      class="transition transform hover:scale-125 bg-gray-300 px-3 py-1 rounded-full">🗑</button>
            </form>
          </div>

          <!-- Status Icon (big on the right) -->
          <div class="text-4xl">
            {% if wager.status == 'won' %}
              <span class="text-green-500">✅</span>
            {% elif wager.status == 'lost' %}
              <span class="text-red-500">❌</span>
            {% else %}
              <span class="text-gray-300">—</span>
            {% endif %}
          </div>
        </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>
  {% endfor %}
</div>
{% endblock %}
